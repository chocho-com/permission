webpackJsonp([4,7],{F3k6:function(e,t){},IXxa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Xxa5"),n=a.n(l),r=a("exGp"),i=a.n(r),s={name:"index",components:{roleDialog:a("XEDa").default},data:function(){return{cPage:1,cSize:10,editData:[],loading:!1,tableOptions:{stripe:!0},tableCols:[{label:"角色名称",colKey:"rolename",align:"center","min-width":"150"},{label:"角色排序",colKey:"roleordernum",align:"center","min-width":"150"}],tableData:[],roleName:"",totalCount:0,currentPage:1,visible:!1}},methods:{handleBack:function(){this.roleName="",this.fetchTableData()},onAdd:function(){this.editData[0]={roleid:"",rolename:"",rolestatus:"",roleordernum:"",modules:[]},this.visible=!0},onEdit:function(e){var t=this;return i()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.editData=[e],a.next=4,t.$api.get("http://47.107.120.160:8081//role/module?id="+e.roleid,{},{returnAll:!0,autoAlert:!1}).then(function(e){t.editData[0].modules=e.data.msg,t.visible=!0});case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(0),console.log(a.t0);case 9:case"end":return a.stop()}},a,t,[[0,6]])}))()},onDelete:function(e){var t=this;return i()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:if(!a.sent){a.next=8;break}return a.next=7,t.$api.delete("http://47.107.120.160:8081//role?id="+e);case 7:t.fetchTableData(t.cPage,t.cSize);case 8:a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),console.log(a.t0);case 13:case"end":return a.stop()}},a,t,[[0,10]])}))()},closeDialog:function(){this.visible=!1,this.editData=[],this.fetchTableData()},fetchTableData:function(){var e=this;return i()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.loading=!0,e.$api.post("http://47.107.120.160:8081//role/get",{roleName:e.roleName},{autoAlert:!1,returnAll:!0}).then(function(t){e.tableData=t.data.msg,e.loading=!1});case 2:case"end":return t.stop()}},t,e)}))()}},created:function(){this.fetchTableData()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"15px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:20}},[a("el-row",[a("el-col",{attrs:{span:21}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",[a("el-input",{attrs:{clearable:""},on:{change:function(t){return e.fetchTableData()}},model:{value:e.roleName,callback:function(t){e.roleName=t},expression:"roleName"}},[a("template",{slot:"prepend"},[e._v("角色名称")])],2)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{plain:"",type:"info"},on:{click:function(t){return e.fetchTableData()}}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{plain:"",type:"primary"},on:{click:e.handleBack}},[e._v("清空")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.onAdd()}}},[e._v("新增")])],1)],1),e._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",border:"",data:e.tableData}},[e._l(e.tableCols,function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.colKey,label:e.label,"min-width":e["min-width"],align:e.align}})}),e._v(" "),a("el-table-column",{attrs:{label:"状态","min-width":"260",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("1"===t.row.rolestatus?"启用":"禁用"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"260",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(a){return e.onEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(a){return e.onDelete(t.row.roleid)}}},[e._v("删除")])]}}])})],2)],1)],1)],1),e._v(" "),a("role-dialog",{attrs:{"edit-data":e.editData,visible:e.visible},on:{closeDialog:e.closeDialog}})],1)},staticRenderFns:[]};var o=a("VU/8")(s,c,!1,function(e){a("LCfq")},null,null);t.default=o.exports},LCfq:function(e,t){},XEDa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("BO1k"),n=a.n(l),r=a("Xxa5"),i=a.n(r),s=a("Dd8w"),c=a.n(s),o=a("exGp"),d=a.n(o),u={props:{visible:Boolean,editData:Array},data:function(){return{form:{rolename:"",rolestatus:"",roledescription:"",roleremarks:""},show:!0,loading:!1,options:[],rules:{roleName:[{required:!0,message:"请输入角色名",trigger:"blur"}]},authTree:[],checkedCases:{},roleModules:[],roleCases:[],moduleCaseMap:{},parentModuleMap:{},checkedList:[],checkVisable:!0,isCheckAll:!1}},mounted:function(){this.fetchAllAuth()},methods:{onSubmit:function(){var e=this;return d()(i.a.mark(function t(){var a,l,n,r,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n in t.prev=0,a=null,e.form,l=[],console.log(e.checkedCases),e.checkedCases)for(r in e.checkedCases[n].isChecked&&l.push(n),e.checkedCases[n].child)e.checkedCases[n].child[r].isChecked&&(l.push(r),!1!==e.checkedCases[n].isChecked||l.includes(n)||l.push(n));if(s={rolename:e.form.rolename,rolestatus:e.form.rolestatus,modules:l.join(",")},""!==e.form.roleid){t.next=13;break}return t.next=10,e.$api.post("http://47.107.120.160:8081//role",s,{autoAlert:!1,returnAll:!0});case 10:a=t.sent,t.next=16;break;case 13:return t.next=15,e.$api.put("http://47.107.120.160:8081//role",c()({},s,{roleid:e.form.roleid}),{autoAlert:!1,returnAll:!0});case 15:a=t.sent;case 16:if(e.$openMsg(a),200!=a.code){t.next=21;break}e.$emit("closeDialog"),t.next=22;break;case 21:throw"fail";case 22:t.next=28;break;case 24:t.prev=24,t.t0=t.catch(0),e.$message.error("操作失败"),console.log(t.t0);case 28:case"end":return t.stop()}},t,e,[[0,24]])}))()},onChange:function(e,t){var a=this;t.child.map(function(l){a.checkedCases[t.moduleID].child[l.moduleID].isChecked=e,a.checkVisable=!1,a.$nextTick(function(){a.checkVisable=!0})})},onChangeSub:function(){var e=this;this.checkVisable=!1,this.$nextTick(function(){e.checkVisable=!0})},checkAll:function(){var e=this;for(var t in this.isCheckAll=!this.isCheckAll,this.checkedCases)for(var a in this.checkedCases[t].isChecked=this.isCheckAll,this.checkedCases[t].child)this.checkedCases[t].child[a].isChecked=this.isCheckAll;this.checkVisable=!1,this.$nextTick(function(){e.checkVisable=!0})},clearAllCheckedCases:function(){for(var e in this.checkedCases)for(var t in this.checkedCases[e].isChecked=!1,this.checkedCases[e].child)this.checkedCases[e].child[t],this.checkedCases[e].child[t].isChecked=!1},fetchAllAuth:function(){var e=this;return d()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.get("/module",{},{autoAlert:!1,returnAll:!0});case 3:a=t.sent,e.authTree=a.data.msg,e.authTree.forEach(function(t){e.checkedCases[t.moduleID]={isChecked:!1,child:{}},t.child.forEach(function(a){e.checkedCases[t.moduleID].child[a.moduleID]={isChecked:!1,child:{}}})}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()}},watch:{visible:{handler:function(e){var t=this;return d()(i.a.mark(function a(){var l,r,s,c,o,d,u;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t.clearAllCheckedCases(),!e||0===t.editData.length){a.next=24;break}for(l=!0,r=!1,s=void 0,a.prev=5,c=n()(t.editData[0].modules);!(l=(o=c.next()).done);l=!0){d=o.value;try{if(void 0!=t.checkedCases[d]);else for(u in t.checkedCases)void 0!=t.checkedCases[u].child&&void 0!=t.checkedCases[u].child[d]&&(t.checkedCases[u].child[d].isChecked=!0)}catch(e){console.log(e)}}a.next=13;break;case 9:a.prev=9,a.t0=a.catch(5),r=!0,s=a.t0;case 13:a.prev=13,a.prev=14,!l&&c.return&&c.return();case 16:if(a.prev=16,!r){a.next=19;break}throw s;case 19:return a.finish(16);case 20:return a.finish(13);case 21:t.form.rolename=t.editData[0].rolename,t.form.rolestatus=t.editData[0].rolestatus,t.form.roleid=t.editData[0].roleid;case 24:t.show=!1,t.$nextTick(function(){t.show=!0});case 26:case"end":return a.stop()}},a,t,[[5,9,13,21],[14,,16,20]])}))()},immediate:!1}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.visible,"before-close":function(){e.$emit("closeDialog")},fullscreen:""},on:{"update:visible":function(t){e.visible=t}}},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading",header:(e.form.roleid?"编辑":"新增")+"角色",shadow:"always"}},[e.show?a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"top",model:e.form,"label-width":"100px",inline:""}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"角色名:",prop:"roleName"}},[a("el-input",{staticStyle:{width:"400px"},model:{value:e.form.rolename,callback:function(t){e.$set(e.form,"rolename",t)},expression:"form.rolename"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"角色状态:",prop:"roleName"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-text":"启用"},model:{value:e.form.rolestatus,callback:function(t){e.$set(e.form,"rolestatus",t)},expression:"form.rolestatus"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-form-item",{attrs:{label:"角色权限:"}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.checkAll}},[e._v("全选")]),e._v(" "),e._l(e.authTree,function(t,l){return a("table",{key:l,staticClass:"gridtable",staticStyle:{width:"60%"},attrs:{border:"1"}},[a("tr",[1==t.status?a("th",{class:e.checkedCases[t.moduleID].isChecked?"blue":"",attrs:{colspan:t.child?t.child.length:0}},[a("el-checkbox",{staticStyle:{"margin-left":"0px","white-space":"normal"},attrs:{label:t.moduleID},on:{change:function(a){return e.onChange(a,t)}},model:{value:e.checkedCases[t.moduleID].isChecked,callback:function(a){e.$set(e.checkedCases[t.moduleID],"isChecked",a)},expression:"checkedCases[item.moduleID].isChecked"}},[e._v(e._s(t.moduleName))])],1):e._e()]),e._v(" "),a("tr",e._l(t.child,function(l,n){return a("td",{key:n,class:e.checkedCases[t.moduleID].child[l.moduleID].isChecked?"blue":""},[e.checkVisable&&1==l.status?a("el-checkbox",{staticStyle:{"margin-left":"0px","white-space":"normal"},attrs:{label:l.moduleID},on:{change:function(a){return e.onChangeSub(a,l.moduleID,t.moduleID)}},model:{value:e.checkedCases[t.moduleID].child[l.moduleID].isChecked,callback:function(a){e.$set(e.checkedCases[t.moduleID].child[l.moduleID],"isChecked",a)},expression:"checkedCases[item.moduleID]['child'][childitem.moduleID].isChecked"}},[e._v(e._s(l.moduleName))]):e._e()],1)}),0)])})],2)],1)],1):e._e(),e._v(" "),a("el-row",{staticStyle:{"margin-top":"50px"},attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:4}},[a("el-button",{on:{click:function(t){return e.$emit("closeDialog")}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.onSubmit}},[e._v(e._s(""!==e.form.roleid?"确认编辑":"确认添加"))])],1)],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,h,!1,function(e){a("F3k6")},"data-v-0c525258",null);t.default=f.exports}});
//# sourceMappingURL=4.cde5c1594dc796a909f0.js.map