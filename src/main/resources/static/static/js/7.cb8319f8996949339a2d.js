webpackJsonp([7],{F3k6:function(e,t){},XEDa:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("BO1k"),c=s.n(a),l=s("Xxa5"),i=s.n(l),r=s("Dd8w"),o=s.n(r),n=s("exGp"),d=s.n(n),h={props:{visible:Boolean,editData:Array},data:function(){return{form:{rolename:"",rolestatus:"",roledescription:"",roleremarks:""},show:!0,loading:!1,options:[],rules:{roleName:[{required:!0,message:"请输入角色名",trigger:"blur"}]},authTree:[],checkedCases:{},roleModules:[],roleCases:[],moduleCaseMap:{},parentModuleMap:{},checkedList:[],checkVisable:!0,isCheckAll:!1}},mounted:function(){this.fetchAllAuth()},methods:{onSubmit:function(){var e=this;return d()(i.a.mark(function t(){var s,a,c,l,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(c in t.prev=0,s=null,e.form,a=[],console.log(e.checkedCases),e.checkedCases)for(l in e.checkedCases[c].isChecked&&a.push(c),e.checkedCases[c].child)e.checkedCases[c].child[l].isChecked&&(a.push(l),!1!==e.checkedCases[c].isChecked||a.includes(c)||a.push(c));if(r={rolename:e.form.rolename,rolestatus:e.form.rolestatus,modules:a.join(",")},""!==e.form.roleid){t.next=13;break}return t.next=10,e.$api.post("http://47.107.120.160:8081//role",r,{autoAlert:!1,returnAll:!0});case 10:s=t.sent,t.next=16;break;case 13:return t.next=15,e.$api.put("http://47.107.120.160:8081//role",o()({},r,{roleid:e.form.roleid}),{autoAlert:!1,returnAll:!0});case 15:s=t.sent;case 16:if(e.$openMsg(s),200!=s.code){t.next=21;break}e.$emit("closeDialog"),t.next=22;break;case 21:throw"fail";case 22:t.next=28;break;case 24:t.prev=24,t.t0=t.catch(0),e.$message.error("操作失败"),console.log(t.t0);case 28:case"end":return t.stop()}},t,e,[[0,24]])}))()},onChange:function(e,t){var s=this;t.child.map(function(a){s.checkedCases[t.moduleID].child[a.moduleID].isChecked=e,s.checkVisable=!1,s.$nextTick(function(){s.checkVisable=!0})})},onChangeSub:function(){var e=this;this.checkVisable=!1,this.$nextTick(function(){e.checkVisable=!0})},checkAll:function(){var e=this;for(var t in this.isCheckAll=!this.isCheckAll,this.checkedCases)for(var s in this.checkedCases[t].isChecked=this.isCheckAll,this.checkedCases[t].child)this.checkedCases[t].child[s].isChecked=this.isCheckAll;this.checkVisable=!1,this.$nextTick(function(){e.checkVisable=!0})},clearAllCheckedCases:function(){for(var e in this.checkedCases)for(var t in this.checkedCases[e].isChecked=!1,this.checkedCases[e].child)this.checkedCases[e].child[t],this.checkedCases[e].child[t].isChecked=!1},fetchAllAuth:function(){var e=this;return d()(i.a.mark(function t(){var s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.get("/module",{},{autoAlert:!1,returnAll:!0});case 3:s=t.sent,e.authTree=s.data.msg,e.authTree.forEach(function(t){e.checkedCases[t.moduleID]={isChecked:!1,child:{}},t.child.forEach(function(s){e.checkedCases[t.moduleID].child[s.moduleID]={isChecked:!1,child:{}}})}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()}},watch:{visible:{handler:function(e){var t=this;return d()(i.a.mark(function s(){var a,l,r,o,n,d,h;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t.clearAllCheckedCases(),!e||0===t.editData.length){s.next=24;break}for(a=!0,l=!1,r=void 0,s.prev=5,o=c()(t.editData[0].modules);!(a=(n=o.next()).done);a=!0){d=n.value;try{if(void 0!=t.checkedCases[d]);else for(h in t.checkedCases)void 0!=t.checkedCases[h].child&&void 0!=t.checkedCases[h].child[d]&&(t.checkedCases[h].child[d].isChecked=!0)}catch(e){console.log(e)}}s.next=13;break;case 9:s.prev=9,s.t0=s.catch(5),l=!0,r=s.t0;case 13:s.prev=13,s.prev=14,!a&&o.return&&o.return();case 16:if(s.prev=16,!l){s.next=19;break}throw r;case 19:return s.finish(16);case 20:return s.finish(13);case 21:t.form.rolename=t.editData[0].rolename,t.form.rolestatus=t.editData[0].rolestatus,t.form.roleid=t.editData[0].roleid;case 24:t.show=!1,t.$nextTick(function(){t.show=!0});case 26:case"end":return s.stop()}},s,t,[[5,9,13,21],[14,,16,20]])}))()},immediate:!1}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.visible,"before-close":function(){e.$emit("closeDialog")},fullscreen:""},on:{"update:visible":function(t){e.visible=t}}},[s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading",header:(e.form.roleid?"编辑":"新增")+"角色",shadow:"always"}},[e.show?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"top",model:e.form,"label-width":"100px",inline:""}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"角色名:",prop:"roleName"}},[s("el-input",{staticStyle:{width:"400px"},model:{value:e.form.rolename,callback:function(t){e.$set(e.form,"rolename",t)},expression:"form.rolename"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"角色状态:",prop:"roleName"}},[s("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-text":"启用"},model:{value:e.form.rolestatus,callback:function(t){e.$set(e.form,"rolestatus",t)},expression:"form.rolestatus"}})],1)],1)],1),e._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-form-item",{attrs:{label:"角色权限:"}},[s("el-button",{attrs:{type:"primary",plain:""},on:{click:e.checkAll}},[e._v("全选")]),e._v(" "),e._l(e.authTree,function(t,a){return s("table",{key:a,staticClass:"gridtable",staticStyle:{width:"60%"},attrs:{border:"1"}},[s("tr",[1==t.status?s("th",{class:e.checkedCases[t.moduleID].isChecked?"blue":"",attrs:{colspan:t.child?t.child.length:0}},[s("el-checkbox",{staticStyle:{"margin-left":"0px","white-space":"normal"},attrs:{label:t.moduleID},on:{change:function(s){return e.onChange(s,t)}},model:{value:e.checkedCases[t.moduleID].isChecked,callback:function(s){e.$set(e.checkedCases[t.moduleID],"isChecked",s)},expression:"checkedCases[item.moduleID].isChecked"}},[e._v(e._s(t.moduleName))])],1):e._e()]),e._v(" "),s("tr",e._l(t.child,function(a,c){return s("td",{key:c,class:e.checkedCases[t.moduleID].child[a.moduleID].isChecked?"blue":""},[e.checkVisable&&1==a.status?s("el-checkbox",{staticStyle:{"margin-left":"0px","white-space":"normal"},attrs:{label:a.moduleID},on:{change:function(s){return e.onChangeSub(s,a.moduleID,t.moduleID)}},model:{value:e.checkedCases[t.moduleID].child[a.moduleID].isChecked,callback:function(s){e.$set(e.checkedCases[t.moduleID].child[a.moduleID],"isChecked",s)},expression:"checkedCases[item.moduleID]['child'][childitem.moduleID].isChecked"}},[e._v(e._s(a.moduleName))]):e._e()],1)}),0)])})],2)],1)],1):e._e(),e._v(" "),s("el-row",{staticStyle:{"margin-top":"50px"},attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{span:4}},[s("el-button",{on:{click:function(t){return e.$emit("closeDialog")}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",plain:""},on:{click:e.onSubmit}},[e._v(e._s(""!==e.form.roleid?"确认编辑":"确认添加"))])],1)],1)],1)],1)},staticRenderFns:[]};var m=s("VU/8")(h,u,!1,function(e){s("F3k6")},"data-v-0c525258",null);t.default=m.exports}});
//# sourceMappingURL=7.cb8319f8996949339a2d.js.map